---
layout: post
title: Water Consumption Monitoring
date: 2020-04-26
published: True
github_comments_issueid: "5"
---

<h1 style="text-align:center">Water SPY</h1>

## <em>Work in Progress ...</em>
<p>&nbsp;</p>

<small><i>Table of contents</i></small>
* Table of contents
{:toc}

# /brief
Last month I got a big surprise on my water bill, 400 EUR worth of water to pay. Turns out there was a leak somewhere by the garden and no sign of water whatsoever so I had no way of noticing it before receiving the bill. Eventually I found the leak and fixed it. I have then decided to monitor the water consumption of the house and have it logged to a database where I could compare it with the pervious months.

<p>&nbsp;</p>
<strong>Tech Stack:</strong> WiFi, Sensor Acquisition, C/C++, JavaScript, npm, Node-Red and Embedded Linux.

# Motivation
* Monitor the water consumption of a House;
* Display data on Node-RED dashboard;
* Telegram message App. bot to access data from outside home network.

# General Architecture
The drawing bellow shows the system level a architecture. The bottom part shows where the Hall-Effect sensor is going to be installed. A uController ESP8266 is then used to process the output of the sensor and publish the data through a HTTP POST into a Node-RED server application running under a BeagleBone Black board. A Node-RED dashboard will then show the water consumption on a time based Graph. 

<p align="center">
  <img width="650" src="../../../../../assets/proj_Water_SPY/general_drawing.png">
</p>


# Hall-Effect Water Sensor
To measure the amount of consumed water I will be using a [Hall-Effect](https://en.wikipedia.org/wiki/Hall_effect_sensor) sensor. The one I am using I bought it in [AliExpress](https://www.aliexpress.com/item/4000125812845.html?spm=a2g0s.9042311.0.0.7fd44c4dnyLl7u) for ~13 CHF. This sensor requires 5V DC as power and it produces on the yellow line a stream of pulses where its frequency is proportional to the amount of water that is passing through the pipe. A calibration procedure will be needed to get a representative water consumption out of it.

<p align="center">
  <img width="200" src="../../../../../assets/proj_Water_SPY/sensor_Water.png">
</p>

# Sensor Output Calibration
To calibrate the sensor output, all that's to be done is to count the amount of pulses the sensor produces for a given amount of water that we feed into it. The bellow water test circuit is used for the calibration procedure:

<p align="center">
  <img width="600" src="../../../../../assets/proj_Water_SPY/calibration.png">
</p>


# ESP uC Code
The uController will be responsible for two main tasks:
1. Count the amount of pulses the sensor generates;
2. HTTP POST the sensor data into Node-RED application;

... 


# Comments
Leave a comment and/or suggestion on this post.

